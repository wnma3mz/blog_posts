---
title: 树莓派折腾记录
date: 2023-11-26 22:39:53
tags: [树莓派]
categories: [笔记]
---

使用树莓派的一些记录

<!-- more -->

### 网络 WiFi 问题

使用的 Zero W，没有网口。所以在不使用图形界面的时候，需要在命令行配置网络

```bash
vim /etc/wpa_supplicant/wpa_supplicant.conf
```

ssid 是 WiFi 名称，psk 是密码，priority 是优先级，数字越大优先级越高。有些低版本的树莓派，只能连接 2.4G 的 Wifi。

```bash
country=US
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
    ssid="ABC"
    psk="password"
    key_mgmt=WPA-PSK
    priority=9
}
```

WiFi 重启命令
```bash
ip link set wlan0 down && ip link set wlan up
```


### fbterm 字体问题

```bash
vim ~/.fbtermrc
```

```bash
font-names=mono
font-size=12
```

https://bbs.deepin.org/post/230435


### 连接 notion

在 notion 创建了一个页面管理日程，使用 Python 定时获取日程信息，写入到 ics 文件中，再搭建一个 nginx 服务。用 IOS 可以直接订阅这个日历，实现日程的同步。

```python
import requests
from datetime import datetime, timedelta, timezone
from icalendar import Calendar, Event

key = ...
dataset_id = ...
url = f"https://api.notion.com/v1/databases/{dataset_id}/query"


today = datetime(datetime.now().year, datetime.now().month, datetime.now().day)
yesterday = today - timedelta(days=1)  # 计算前一天的时间

payload = {
    "page_size": 100,
    "filter": {
        "and": [
               {"property": "Status", "status": {"does_not_equal": "Done"}},
         {"or": [
            {
                "property": "日期",
                "date": {
                    "on_or_after": datetime.strftime(yesterday, "%Y-%m-%d"),
                },
            },
            {
                "property": "日期",
                "date": {
                    "is_empty": True,
                },
            },
        ]}
        ]
    },
}

headers = {
    "accept": "application/json",
    "Notion-Version": "2022-06-28",
    "content-type": "application/json",
    "Authorization": f"Bearer {key}",
}


def str2date(x):
    if len(x) != 10:
        #return datetime.strptime(x, "%Y-%m-%dT%H:%M:%S.%f%z").replace(tzinfo=timezone.utc)
        return datetime.strptime(x, "%Y-%m-%dT%H:%M:%S.%f%z")
    else:
        return datetime.strptime(x, "%Y-%m-%d")


if __name__ == "__main__":
    response = requests.post(url, headers=headers, json=payload)
    data_lst = response.json()["results"]

    cal = Calendar()
    cal["version"] = "2.0"
    cal["prodid"] = "-//WNMA ICS//ZH"

    for item in data_lst:
        try:
            summary = item["properties"]["标题"]["title"][0]["plain_text"]
        except:
            print(item)
            continue
        text_lst = item["properties"]["备注"]["rich_text"]
        description = text_lst[0]["plain_text"] if len(text_lst) else ""

        flag = True
        if item["properties"]["日期"]["date"]:
            start_date = item["properties"]["日期"]["date"]["start"]
            end_date = item["properties"]["日期"]["date"]["end"]
            dtstart = str2date(start_date)
            if end_date:
                flag = False
                dtend = str2date(end_date)
        if flag:
            dtstart, dtend = today, today + timedelta(days=1)

        event = Event()
        event.add("summary", summary)
        event.add("description", description)
        event.add("dtstart", dtstart)
        event.add("dtend", dtend)
        cal.add_component(event)

    with open("/data/my.ics", "wb") as f:
        f.write(cal.to_ical())
```